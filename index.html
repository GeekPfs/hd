<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Gerenciador de Drive</title>
  <style>
    body { font-family: sans-serif; margin: 2rem; }
    button { margin: 0.5rem 0; }
    #file-list { margin-top: 1rem; }
    li { margin: 0.25rem 0; }
  </style>
</head>
<body>
  <h1>Gerenciador de Google Drive</h1>

  <button id="authorize_button">Conectar ao Google Drive</button>
  <button id="signout_button" style="display:none;">Sair</button>

  <h2>Arquivos</h2>
  <ul id="file-list"></ul>

  <h2>Criar Pasta</h2>
  <input type="text" id="folder-name" placeholder="Nome da pasta">
  <button id="create-folder">Criar Pasta</button>

  <h2>Upload de Arquivo</h2>
  <input type="file" id="file-input">
  <button id="upload-file">Enviar Arquivo</button>

  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    const CLIENT_ID = '220763720225-nmqu93a2ic9k4o4t76pags6oamil7ja0.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyDxBlnzdk8bcmQJhHaq_Oa1zFeBK7UsvBg';
    const DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];
    const SCOPES = 'https://www.googleapis.com/auth/drive';

    const authorizeButton = document.getElementById('authorize_button');
    const signoutButton = document.getElementById('signout_button');

    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: DISCOVERY_DOCS,
        scope: SCOPES
      }).then(() => {
        gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
        updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
        authorizeButton.onclick = () => gapi.auth2.getAuthInstance().signIn();
        signoutButton.onclick = () => gapi.auth2.getAuthInstance().signOut();
      });
    }

    function updateSigninStatus(isSignedIn) {
      if (isSignedIn) {
        authorizeButton.style.display = 'none';
        signoutButton.style.display = 'block';
        listFiles();
      } else {
        authorizeButton.style.display = 'block';
        signoutButton.style.display = 'none';
        document.getElementById('file-list').innerHTML = '';
      }
    }

    function listFiles() {
      gapi.client.drive.files.list({
        pageSize: 20,
        fields: "files(id, name, mimeType)"
      }).then(response => {
        const files = response.result.files;
        const fileList = document.getElementById('file-list');
        fileList.innerHTML = '';
        if (files && files.length > 0) {
          files.forEach(file => {
            const li = document.createElement('li');
            li.textContent = `${file.name} (${file.mimeType})`;
            fileList.appendChild(li);
          });
        } else {
          fileList.innerHTML = '<li>Nenhum arquivo encontrado.</li>';
        }
      });
    }

    document.getElementById('create-folder').addEventListener('click', () => {
      const folderName = document.getElementById('folder-name').value;
      if (!folderName) return alert('Digite o nome da pasta!');
      
      const fileMetadata = {
        name: folderName,
        mimeType: 'application/vnd.google-apps.folder'
      };

      gapi.client.drive.files.create({
        resource: fileMetadata,
        fields: 'id'
      }).then(() => {
        alert('Pasta criada!');
        listFiles();
      });
    });

    document.getElementById('upload-file').addEventListener('click', () => {
      const fileInput = document.getElementById('file-input');
      if (!fileInput.files.length) return alert('Escolha um arquivo!');

      const file = fileInput.files[0];
      const metadata = {
        name: file.name
      };
      const accessToken = gapi.auth.getToken().access_token;
      const form = new FormData();
      form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
      form.append('file', file);

      fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id', {
        method: 'POST',
        headers: new Headers({ 'Authorization': 'Bearer ' + accessToken }),
        body: form
      }).then(response => response.json())
        .then(() => { alert('Arquivo enviado!'); listFiles(); });
    });

    handleClientLoad();
  </script>
</body>
</html>
